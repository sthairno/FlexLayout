name: Install OpenSiv3D SDK
description: Download the OpenSiv3D SDK for Windows from the URL and unpack it to the destination path.

inputs:
  download-url:
    description: Url for downloading .zip file
    required: true
  siv3d-version:
    description: OpenSiv3D version
    required: true
  env:
    description: OpenSiv3D environment variable name
    required: true
  destination:
    description: Installation path
    default: '.'

runs:
  using: 'composite'
  steps:
    - name: Cache SDK Files
      id: cache-sdk
      uses: actions/cache@v4
      with:
        path: ${{ inputs.destination }}
        key: siv3d-sdk-${{ inputs.siv3d-version }}

    - name: Download SDK Zip File
      if: steps.cache-sdk.outputs.cache-hit != 'true'
      shell: bash
      run: |
        curl -L -o '${{ runner.temp }}/sdk.zip' '${{ inputs.download-url }}'

    - name: Extract SDK Files
      if: steps.cache-sdk.outputs.cache-hit != 'true'
      shell: bash
      run: |
        tmp_zippath='${{ runner.temp }}/sdk.zip'
        tmp_sdkpath='${{ runner.temp }}/sdk'
        destination_path='${{ inputs.destination }}'

        unzip -d $tmp_sdkpath $tmp_zippath
        mkdir -p $destination_path
        cp "$tmp_sdkpath/$(ls $tmp_sdkpath | head -n 1)/*" $destination_path
        rm -r $tmp_sdkpath $tmp_zippath
    
    - name: Set environment variable
      shell: bash
      run: |
        fullpath=$(readlink -f .)
        echo "OpenSiv3D SDK installed at: $fullpath"
        
        echo "${{ inputs.env }}=$fullpath" >> $GITHUB_ENV
        echo "SDK path variable is: ${{ inputs.env }}"
